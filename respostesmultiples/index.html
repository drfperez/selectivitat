<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Selectivitat: Tecnologia i Enginyeria</title>
<style>
:root {
    --bg-color: #f4f7fa;
    --text-color: #111;
    --card-color: #fff;
    --btn-color: #e7e9ec;
    --btn-hover: #d0d4e0;
    --accent-color: #0059b3;
    --correct-color: #4CAF50;
    --wrong-color: #E53935;
}

body.dark {
    --bg-color: #0f1114;
    --text-color: #eaeaea;
    --card-color: #1c1f23;
    --btn-color: #2a2e33;
    --btn-hover: #3b4148;
    --accent-color: #7ab8ff;
    --correct-color: #3fa44a;
    --wrong-color: #cc4a4a;
}

body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: var(--bg-color);
    color: var(--text-color);
    transition: background 0.4s ease, color 0.4s ease;
}

header {
    background: var(--accent-color);
    color: white;
    padding: 20px;
    text-align: center;
    position: relative;
}

.mode-toggle {
    position: absolute;
    top: 15px;
    right: 20px;
    cursor: pointer;
    font-size: 1.6em;
    user-select: none;
}

.setup-card, .question-card {
    background: var(--card-color);
    padding: 15px;
    margin: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.12);
}

.answers button {
    display: block;
    margin: 7px 0;
    padding: 12px;
    width: 100%;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    background: var(--btn-color);
    color: var(--text-color);
}

.correct { background: var(--correct-color) !important; color: white !important; }
.wrong { background: var(--wrong-color) !important; color: white !important; }

.progress-container {
    background: #bbb;
    border-radius: 10px;
    overflow: hidden;
    height: 20px;
    margin-bottom: 20px;
}

.progress-bar {
    background: var(--accent-color);
    height: 100%;
    width: 0%;
    transition: width 0.3s ease;
}

button {
    transition: background 0.25s;
}

#restart-btn, #start-btn {
    padding: 12px 24px;
    background: var(--accent-color);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 20px;
    font-size: 1.1em;
}

footer {
    text-align: center;
    padding: 15px;
    opacity: 0.7;
}
</style>
</head>
<body>

<header>
    <h1>Selectivitat: Tecnologia i Enginyeria</h1>
    <span class="mode-toggle" onclick="toggleMode()">🌞</span>
</header>

<main id="quiz">
</main>

<footer>
    &copy; 2025 Nom Alumne
</footer>

<script>
let darkMode = false;
let score = 0;
let answered = 0;
let totalQuestions = 0;
let timerInterval;
let timeLeft;
let selectedQuestions = [];

function toggleMode() {
    darkMode = !darkMode;
    document.body.classList.toggle('dark', darkMode);
    document.querySelector('.mode-toggle').textContent = darkMode ? '🌙' : '🌞';
}

showSetupMenu();

function showSetupMenu() {
    const quiz = document.getElementById('quiz');
    quiz.innerHTML = `
    <div class="setup-card">
        <h3>Configuració del test</h3>
        <label>Nombre de preguntes (màx. 20):</label>
        <input id="qNumber" type="number" min="1" value="10" style="width:80px"><br><br>
        <label>Temps total en minuts:</label>
        <input id="qTime" type="number" min="1" value="10" style="width:80px"><br><br>
        <button id="start-btn" onclick="startQuiz()">Començar</button>
    </div>`;
}

async function startQuiz() {
    const response = await fetch('preguntes.json');
    const data = await response.json();
    const qNum = parseInt(document.getElementById('qNumber').value);
    const qTime = parseInt(document.getElementById('qTime').value);

    timeLeft = qTime * 60;

    selectedQuestions = shuffle(data).slice(0, qNum);
    totalQuestions = selectedQuestions.length;

    loadQuestions();
}

function shuffle(arr) {
    return arr.sort(() => Math.random() - 0.5);
}

function startTimer() {
    updateTimerDisplay();
    timerInterval = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        if(timeLeft <= 0) {
            clearInterval(timerInterval);
            finishQuiz();
        }
    }, 1000);
}

function updateTimerDisplay() {
    const minutes = Math.floor(timeLeft / 60).toString().padStart(2,'0');
    const seconds = (timeLeft % 60).toString().padStart(2,'0');
    document.getElementById('timer').textContent = `Temps: ${minutes}:${seconds}`;
}

function finishQuiz() {
    const quiz = document.getElementById('quiz');
    const percent = Math.round((score/totalQuestions)*100);

    let message = '';
    if(percent >= 90) message = 'Sobresalient';
    else if(percent >= 70) message = 'Notable';
    else if(percent >= 50) message = 'Aprovat';
    else message = 'Suspès';

    quiz.innerHTML = `<p>Puntuació final: ${score}/${totalQuestions} (${percent}%)</p>
                      <p>${message}</p>
                      <button id="restart-btn" onclick="showSetupMenu()">Tornar</button>`;
}

function loadQuestions() {
    clearInterval(timerInterval);
    score = 0;
    answered = 0;

    const quiz = document.getElementById('quiz');
    quiz.innerHTML = `
        <div id="timer"></div>
        <div id="score">Puntuació: 0/${totalQuestions}</div>
        <div class="progress-container"><div class="progress-bar" id="progress"></div></div>
    `;
    startTimer();

    selectedQuestions.forEach((q, i) => {
        const card = document.createElement('div');
        card.className = 'question-card';
        card.innerHTML = `<p><strong>${i+1}. ${q.pregunta}</strong></p>
                          <div class="answers"></div><div class="feedback"></div>`;
        const ansDiv = card.querySelector('.answers');
        shuffle(q.respostes).forEach(r => {
            const btn = document.createElement('button');
            btn.textContent = r.text;
            btn.onclick = () => {
                if(btn.disabled) return;
                if(r.correcta) {
                    btn.classList.add('correct');
                    score++;
                } else {
                    btn.classList.add('wrong');
                }
                card.querySelector('.feedback').textContent = r.feedback;
                Array.from(ansDiv.children).forEach(b => b.disabled = true);
                answered++;
                document.getElementById('score').textContent = `Puntuació: ${score}/${totalQuestions}`;
                document.getElementById('progress').style.width = `${(answered/totalQuestions)*100}%`;
                if(answered === totalQuestions) {
                    clearInterval(timerInterval);
                    finishQuiz();
                }
            };
            ansDiv.appendChild(btn);
        });
        quiz.appendChild(card);
    });
}
</script>

</body>
</html>

  
